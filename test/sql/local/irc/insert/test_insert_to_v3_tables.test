# name: test/sql/local/irc/insert/test_insert_to_v3_tables.test
# group: [insert]

require-env DUCKDB_ICEBERG_HAVE_GENERATED_DATA

require avro

require parquet

require iceberg

require httpfs

statement ok
CREATE SECRET (
    TYPE S3,
    KEY_ID 'admin',
    SECRET 'password',
    ENDPOINT '127.0.0.1:9000',
    URL_STYLE 'path',
    USE_SSL 0
);


statement ok
ATTACH '' AS my_datalake (
    TYPE ICEBERG,
    CLIENT_ID 'admin',
    CLIENT_SECRET 'password',
    ENDPOINT 'http://127.0.0.1:8181'
);

statement ok
CALL enable_logging('Iceberg');

query I
select count(*) from my_datalake.default.simple_v3_table;
----
75000

query I
select count(*) from my_datalake.default.simple_v3_table where c_custkey > 75_000;
----
37500

query I
select count(*) from my_datalake.default.simple_v3_table where c_custkey > 50_000;
----
50_000

query I
select count(*) from my_datalake.default.simple_v3_table where c_custkey < 75_000;
----
37500

query I
select count(*) from my_datalake.default.simple_v3_table where c_custkey > 25_000 and c_custkey < 75_000;
----
25000

statement error
insert into my_datalake.default.simple_v3_table values (100000000, 'Customer#1000000000', 'jsdjsdffi', 4, 06-122-922-9374, 9281.24, 'FURNITURE', 'ducks are human beings');
----
<REGEX>:.*Not implemented Error: Insert into Iceberg V3 tables.*

