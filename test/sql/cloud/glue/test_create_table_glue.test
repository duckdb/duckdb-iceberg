# name: test/sql/cloud/glue/test_create_table_glue.test
# description: test createing a table in glue
# group: [glue]

require-env ICEBERG_AWS_REMOTE_AVAILABLE

require-env AWS_ACCESS_KEY_ID

require-env AWS_SECRET_ACCESS_KEY

require avro

require parquet

require iceberg

require httpfs

require aws

set ignore_error_messages

statement ok
CREATE SECRET (
  TYPE S3,
  PROVIDER credential_chain,
  REGION 'us-east-1'
);

statement ok
attach '840140254803:s3tablescatalog/duckdblabs-iceberg-testing' as my_datalake (
    TYPE ICEBERG,
    ENDPOINT_TYPE 'GLUE'
);

statement ok
use my_datalake.tpch_sf01;

statement ok
call enable_logging(level='DEBUG');

statement ok
drop table if exists test_create;

statement ok
create table test_create as select * from range(0,100);

statement ok
drop table test_create;

# below is not deterministic depending on location. Check that when timeout is reached, it is logged properly
mode skip

statement ok
set http_timeout=1;

statement error
create table test_create_2 as select range a from range(100);
----
<REGEX>:.*Error.*

query I
select count(*) from duckdb_logs_parsed('HTTP') where response.reason like '%Timeout was reached;%';
----
1
