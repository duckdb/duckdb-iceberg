# name: test/sql/cloud/snowflake/test_snowflake.test
# description: test integration with iceberg catalog read
# group: [snowflake]

require-env ICEBERG_SNOWFLAKE_REMOTE_AVAILABLE

require-env SNOWFLAKE_KEY_ID_GCS

require-env SNOWFLAKE_SECRET_KEY_GCS

require-env SNOWFLAKE_CATALOG_URI_GCS

require avro

require parquet

require iceberg

require httpfs

require aws


# Do not ignore 'HTTP' error messages!
set ignore_error_messages


statement ok
create secret polaris_secret (
	TYPE ICEBERG,
	CLIENT_ID '${SNOWFLAKE_KEY_ID_GCS}',
	CLIENT_SECRET '${SNOWFLAKE_SECRET_KEY_GCS}',
	ENDPOINT '${SNOWFLAKE_CATALOG_URI_GCS}'
);


statement ok
attach 'GCS_catalog' as my_datalake (
	type ICEBERG,
	ENDPOINT '${SNOWFLAKE_CATALOG_URI_GCS}'
);


query I
select * from my_datalake.default.duckdb_created_table;
----
0
1
2
3
4
5
6
7
8
9
